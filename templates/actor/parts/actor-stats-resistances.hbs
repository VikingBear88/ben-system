<!-- systems/ben-system/templates/actor/actor-stats-resistances.hbs -->
<section class="ben-resistances">

  <!-- TOP TABLE: totals coming from benefitresist items (level >= 1 only) -->
  <table class="ben-table ben-table--tight resistances-table">
    <thead>
      <tr>
        <th>Damage Type</th>
        <th class="num">Flat Resistance</th>
        <th class="num">Per Dice Resistance</th>
        <th class="num">Per Status Effect Level</th>
      </tr>
    </thead>
    <tbody>
      {{#each benefitResistRows as |row|}}
        <tr>
          <td class="group-label">{{row.type}}</td>
          <td class="num">{{row.flat}}</td>
          <td class="num">{{row.perDice}}</td>
          <td class="num">{{row.perLevel}}</td>
        </tr>
      {{/each}}
    </tbody>
  </table>

  <!-- BENEFIT RESISTANCES: item container, filtered to benefitLevel >= 1 -->
  <h3>Benefit Resistances</h3>
  <ol class="items-list benefitresist-list">
    <li class="items-header flexrow">
      <div class="item-name">Item</div>
      <div class="item-field">Damage Type</div>
      <div class="item-field">Mode</div>
      <div class="item-field num">Benefit Level</div>
      <div class="item-field num">Resistance</div>
      <div class="item-controls"></div>
    </li>

    {{#each actor.items as |it|}}
      {{#if (eq it.type "benefitresist")}}
        {{#if it.system.ui.benefitLevel}} {{!-- 0 is falsy; only show >=1 --}}
          <li class="item flexrow benefitresist-row" data-item-id="{{it._id}}">
            <div class="item-name">
              <div class="item-image">
                <img src="{{it.img}}" title="{{it.name}}" width="24" height="24"/>
              </div>
              <h4>{{it.name}}</h4>
            </div>

            <div class="item-field">{{it.system.damageType}}</div>
            <div class="item-field">
              {{#if (eq it.system.mode "flat")}}Flat{{/if}}
              {{#if (eq it.system.mode "perDice")}}Per Dice{{/if}}
              {{#if (eq it.system.mode "perLevel")}}Per Status Level{{/if}}
            </div>
            <div class="item-field num">{{it.system.ui.benefitLevel}}</div>
            <div class="item-field num">{{it.system.ui.resistance}}</div>

            <div class="item-controls">
              <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
              <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
            </div>
          </li>
        {{/if}}
      {{/if}}
    {{/each}}
  </ol>

</section>

<style>
  .ben-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
  .ben-table th, .ben-table td { padding: 6px 8px; border: 1px solid rgba(0,0,0,.25); }
  .ben-table thead th { background: #cfe2ff; text-align: left; }
  .ben-table .num { text-align: right; }
  .ben-table--tight th, .ben-table--tight td { padding-top: 4px; padding-bottom: 4px; }
  .group-label { font-weight: 600; }

  .benefitresist-list .items-header .item-name { flex: 2 1 40%; }
  .benefitresist-list .items-header .item-field { flex: 1 0 15%; text-align: center; }
  .benefitresist-list .item { align-items: center; }
  .benefitresist-list .item .item-name { flex: 2 1 40%; display: flex; align-items: center; gap: 6px; }
  .benefitresist-list .item .item-field { flex: 1 0 15%; display: flex; align-items: center; justify-content: center; text-align: center; }
  .benefitresist-list .item .item-controls { flex: 0 0 auto; }
</style>



